<style>.markdown-body .octicon {
    display: inline-block;
    fill: currentColor;
    vertical-align: text-bottom;
  }
  
  .markdown-body .anchor {
    float: left;
    line-height: 1;
    margin-left: -20px;
    padding-right: 4px;
  }
  
  .markdown-body .anchor:focus {
    outline: none;
  }
  
  .markdown-body h1 .octicon-link,
  .markdown-body h2 .octicon-link,
  .markdown-body h3 .octicon-link,
  .markdown-body h4 .octicon-link,
  .markdown-body h5 .octicon-link,
  .markdown-body h6 .octicon-link {
    color: #1b1f23;
    vertical-align: middle;
    visibility: hidden;
  }
  
  .markdown-body h1:hover .anchor,
  .markdown-body h2:hover .anchor,
  .markdown-body h3:hover .anchor,
  .markdown-body h4:hover .anchor,
  .markdown-body h5:hover .anchor,
  .markdown-body h6:hover .anchor {
    text-decoration: none;
  }
  
  .markdown-body h1:hover .anchor .octicon-link,
  .markdown-body h2:hover .anchor .octicon-link,
  .markdown-body h3:hover .anchor .octicon-link,
  .markdown-body h4:hover .anchor .octicon-link,
  .markdown-body h5:hover .anchor .octicon-link,
  .markdown-body h6:hover .anchor .octicon-link {
    visibility: visible;
  }
  
  .markdown-body h1:hover .anchor .octicon-link:before,
  .markdown-body h2:hover .anchor .octicon-link:before,
  .markdown-body h3:hover .anchor .octicon-link:before,
  .markdown-body h4:hover .anchor .octicon-link:before,
  .markdown-body h5:hover .anchor .octicon-link:before,
  .markdown-body h6:hover .anchor .octicon-link:before {
    width: 16px;
    height: 16px;
    content: ' ';
    display: inline-block;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'%3E%3C/path%3E%3C/svg%3E");
  }.markdown-body {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    line-height: 1.5;
    color: #24292e;
    font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
  }
  
  .markdown-body details {
    display: block;
  }
  
  .markdown-body summary {
    display: list-item;
  }
  
  .markdown-body a {
    background-color: initial;
  }
  
  .markdown-body a:active,
  .markdown-body a:hover {
    outline-width: 0;
  }
  
  .markdown-body strong {
    font-weight: inherit;
    font-weight: bolder;
  }
  
  .markdown-body h1 {
    font-size: 2em;
    margin: .67em 0;
  }
  
  .markdown-body img {
    border-style: none;
  }
  
  .markdown-body code,
  .markdown-body kbd,
  .markdown-body pre {
    font-family: monospace,monospace;
    font-size: 1em;
  }
  
  .markdown-body hr {
    box-sizing: initial;
    height: 0;
    overflow: visible;
  }
  
  .markdown-body input {
    font: inherit;
    margin: 0;
  }
  
  .markdown-body input {
    overflow: visible;
  }
  
  .markdown-body [type=checkbox] {
    box-sizing: border-box;
    padding: 0;
  }
  
  .markdown-body * {
    box-sizing: border-box;
  }
  
  .markdown-body input {
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
  }
  
  .markdown-body a {
    color: #0366d6;
    text-decoration: none;
  }
  
  .markdown-body a:hover {
    text-decoration: underline;
  }
  
  .markdown-body strong {
    font-weight: 600;
  }
  
  .markdown-body hr {
    height: 0;
    margin: 15px 0;
    overflow: hidden;
    background: transparent;
    border: 0;
    border-bottom: 1px solid #dfe2e5;
  }
  
  .markdown-body hr:after,
  .markdown-body hr:before {
    display: table;
    content: "";
  }
  
  .markdown-body hr:after {
    clear: both;
  }
  
  .markdown-body table {
    border-spacing: 0;
    border-collapse: collapse;
  }
  
  .markdown-body td,
  .markdown-body th {
    padding: 0;
  }
  
  .markdown-body details summary {
    cursor: pointer;
  }
  
  .markdown-body kbd {
    display: inline-block;
    padding: 3px 5px;
    font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    line-height: 10px;
    color: #444d56;
    vertical-align: middle;
    background-color: #fafbfc;
    border: 1px solid #d1d5da;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #d1d5da;
  }
  
  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    margin-top: 0;
    margin-bottom: 0;
  }
  
  .markdown-body h1 {
    font-size: 32px;
  }
  
  .markdown-body h1,
  .markdown-body h2 {
    font-weight: 600;
  }
  
  .markdown-body h2 {
    font-size: 24px;
  }
  
  .markdown-body h3 {
    font-size: 20px;
  }
  
  .markdown-body h3,
  .markdown-body h4 {
    font-weight: 600;
  }
  
  .markdown-body h4 {
    font-size: 16px;
  }
  
  .markdown-body h5 {
    font-size: 14px;
  }
  
  .markdown-body h5,
  .markdown-body h6 {
    font-weight: 600;
  }
  
  .markdown-body h6 {
    font-size: 12px;
  }
  
  .markdown-body p {
    margin-top: 0;
    margin-bottom: 10px;
  }
  
  .markdown-body blockquote {
    margin: 0;
  }
  
  .markdown-body ol,
  .markdown-body ul {
    padding-left: 0;
    margin-top: 0;
    margin-bottom: 0;
  }
  
  .markdown-body ol ol,
  .markdown-body ul ol {
    list-style-type: lower-roman;
  }
  
  .markdown-body ol ol ol,
  .markdown-body ol ul ol,
  .markdown-body ul ol ol,
  .markdown-body ul ul ol {
    list-style-type: lower-alpha;
  }
  
  .markdown-body dd {
    margin-left: 0;
  }
  
  .markdown-body code,
  .markdown-body pre {
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
  }
  
  .markdown-body pre {
    margin-top: 0;
    margin-bottom: 0;
  }
  
  .markdown-body input::-webkit-inner-spin-button,
  .markdown-body input::-webkit-outer-spin-button {
    margin: 0;
    -webkit-appearance: none;
    appearance: none;
  }
  
  .markdown-body :checked+.radio-label {
    position: relative;
    z-index: 1;
    border-color: #0366d6;
  }
  
  .markdown-body .border {
    border: 1px solid #e1e4e8!important;
  }
  
  .markdown-body .border-0 {
    border: 0!important;
  }
  
  .markdown-body .border-bottom {
    border-bottom: 1px solid #e1e4e8!important;
  }
  
  .markdown-body .rounded-1 {
    border-radius: 3px!important;
  }
  
  .markdown-body .bg-white {
    background-color: #fff!important;
  }
  
  .markdown-body .bg-gray-light {
    background-color: #fafbfc!important;
  }
  
  .markdown-body .text-gray-light {
    color: #6a737d!important;
  }
  
  .markdown-body .mb-0 {
    margin-bottom: 0!important;
  }
  
  .markdown-body .my-2 {
    margin-top: 8px!important;
    margin-bottom: 8px!important;
  }
  
  .markdown-body .pl-0 {
    padding-left: 0!important;
  }
  
  .markdown-body .py-0 {
    padding-top: 0!important;
    padding-bottom: 0!important;
  }
  
  .markdown-body .pl-1 {
    padding-left: 4px!important;
  }
  
  .markdown-body .pl-2 {
    padding-left: 8px!important;
  }
  
  .markdown-body .py-2 {
    padding-top: 8px!important;
    padding-bottom: 8px!important;
  }
  
  .markdown-body .pl-3,
  .markdown-body .px-3 {
    padding-left: 16px!important;
  }
  
  .markdown-body .px-3 {
    padding-right: 16px!important;
  }
  
  .markdown-body .pl-4 {
    padding-left: 24px!important;
  }
  
  .markdown-body .pl-5 {
    padding-left: 32px!important;
  }
  
  .markdown-body .pl-6 {
    padding-left: 40px!important;
  }
  
  .markdown-body .f6 {
    font-size: 12px!important;
  }
  
  .markdown-body .lh-condensed {
    line-height: 1.25!important;
  }
  
  .markdown-body .text-bold {
    font-weight: 600!important;
  }
  
  .markdown-body .pl-c {
    color: #6a737d;
  }
  
  .markdown-body .pl-c1,
  .markdown-body .pl-s .pl-v {
    color: #005cc5;
  }
  
  .markdown-body .pl-e,
  .markdown-body .pl-en {
    color: #6f42c1;
  }
  
  .markdown-body .pl-s .pl-s1,
  .markdown-body .pl-smi {
    color: #24292e;
  }
  
  .markdown-body .pl-ent {
    color: #22863a;
  }
  
  .markdown-body .pl-k {
    color: #d73a49;
  }
  
  .markdown-body .pl-pds,
  .markdown-body .pl-s,
  .markdown-body .pl-s .pl-pse .pl-s1,
  .markdown-body .pl-sr,
  .markdown-body .pl-sr .pl-cce,
  .markdown-body .pl-sr .pl-sra,
  .markdown-body .pl-sr .pl-sre {
    color: #032f62;
  }
  
  .markdown-body .pl-smw,
  .markdown-body .pl-v {
    color: #e36209;
  }
  
  .markdown-body .pl-bu {
    color: #b31d28;
  }
  
  .markdown-body .pl-ii {
    color: #fafbfc;
    background-color: #b31d28;
  }
  
  .markdown-body .pl-c2 {
    color: #fafbfc;
    background-color: #d73a49;
  }
  
  .markdown-body .pl-c2:before {
    content: "^M";
  }
  
  .markdown-body .pl-sr .pl-cce {
    font-weight: 700;
    color: #22863a;
  }
  
  .markdown-body .pl-ml {
    color: #735c0f;
  }
  
  .markdown-body .pl-mh,
  .markdown-body .pl-mh .pl-en,
  .markdown-body .pl-ms {
    font-weight: 700;
    color: #005cc5;
  }
  
  .markdown-body .pl-mi {
    font-style: italic;
    color: #24292e;
  }
  
  .markdown-body .pl-mb {
    font-weight: 700;
    color: #24292e;
  }
  
  .markdown-body .pl-md {
    color: #b31d28;
    background-color: #ffeef0;
  }
  
  .markdown-body .pl-mi1 {
    color: #22863a;
    background-color: #f0fff4;
  }
  
  .markdown-body .pl-mc {
    color: #e36209;
    background-color: #ffebda;
  }
  
  .markdown-body .pl-mi2 {
    color: #f6f8fa;
    background-color: #005cc5;
  }
  
  .markdown-body .pl-mdr {
    font-weight: 700;
    color: #6f42c1;
  }
  
  .markdown-body .pl-ba {
    color: #586069;
  }
  
  .markdown-body .pl-sg {
    color: #959da5;
  }
  
  .markdown-body .pl-corl {
    text-decoration: underline;
    color: #032f62;
  }
  
  .markdown-body .mb-0 {
    margin-bottom: 0!important;
  }
  
  .markdown-body .my-2 {
    margin-bottom: 8px!important;
  }
  
  .markdown-body .my-2 {
    margin-top: 8px!important;
  }
  
  .markdown-body .pl-0 {
    padding-left: 0!important;
  }
  
  .markdown-body .py-0 {
    padding-top: 0!important;
    padding-bottom: 0!important;
  }
  
  .markdown-body .pl-1 {
    padding-left: 4px!important;
  }
  
  .markdown-body .pl-2 {
    padding-left: 8px!important;
  }
  
  .markdown-body .py-2 {
    padding-top: 8px!important;
    padding-bottom: 8px!important;
  }
  
  .markdown-body .pl-3 {
    padding-left: 16px!important;
  }
  
  .markdown-body .pl-4 {
    padding-left: 24px!important;
  }
  
  .markdown-body .pl-5 {
    padding-left: 32px!important;
  }
  
  .markdown-body .pl-6 {
    padding-left: 40px!important;
  }
  
  .markdown-body .pl-7 {
    padding-left: 48px!important;
  }
  
  .markdown-body .pl-8 {
    padding-left: 64px!important;
  }
  
  .markdown-body .pl-9 {
    padding-left: 80px!important;
  }
  
  .markdown-body .pl-10 {
    padding-left: 96px!important;
  }
  
  .markdown-body .pl-11 {
    padding-left: 112px!important;
  }
  
  .markdown-body .pl-12 {
    padding-left: 128px!important;
  }
  
  .markdown-body hr {
    border-bottom-color: #eee;
  }
  
  .markdown-body kbd {
    display: inline-block;
    padding: 3px 5px;
    font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    line-height: 10px;
    color: #444d56;
    vertical-align: middle;
    background-color: #fafbfc;
    border: 1px solid #d1d5da;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #d1d5da;
  }
  
  .markdown-body:after,
  .markdown-body:before {
    display: table;
    content: "";
  }
  
  .markdown-body:after {
    clear: both;
  }
  
  .markdown-body>:first-child {
    margin-top: 0!important;
  }
  
  .markdown-body>:last-child {
    margin-bottom: 0!important;
  }
  
  .markdown-body a:not([href]) {
    color: inherit;
    text-decoration: none;
  }
  
  .markdown-body blockquote,
  .markdown-body details,
  .markdown-body dl,
  .markdown-body ol,
  .markdown-body p,
  .markdown-body pre,
  .markdown-body table,
  .markdown-body ul {
    margin-top: 0;
    margin-bottom: 16px;
  }
  
  .markdown-body hr {
    height: .25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
  }
  
  .markdown-body blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: .25em solid #dfe2e5;
  }
  
  .markdown-body blockquote>:first-child {
    margin-top: 0;
  }
  
  .markdown-body blockquote>:last-child {
    margin-bottom: 0;
  }
  
  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
  }
  
  .markdown-body h1 {
    font-size: 2em;
  }
  
  .markdown-body h1,
  .markdown-body h2 {
    padding-bottom: .3em;
    border-bottom: 1px solid #eaecef;
  }
  
  .markdown-body h2 {
    font-size: 1.5em;
  }
  
  .markdown-body h3 {
    font-size: 1.25em;
  }
  
  .markdown-body h4 {
    font-size: 1em;
  }
  
  .markdown-body h5 {
    font-size: .875em;
  }
  
  .markdown-body h6 {
    font-size: .85em;
    color: #6a737d;
  }
  
  .markdown-body ol,
  .markdown-body ul {
    padding-left: 2em;
  }
  
  .markdown-body ol ol,
  .markdown-body ol ul,
  .markdown-body ul ol,
  .markdown-body ul ul {
    margin-top: 0;
    margin-bottom: 0;
  }
  
  .markdown-body li {
    word-wrap: break-all;
  }
  
  .markdown-body li>p {
    margin-top: 16px;
  }
  
  .markdown-body li+li {
    margin-top: .25em;
  }
  
  .markdown-body dl {
    padding: 0;
  }
  
  .markdown-body dl dt {
    padding: 0;
    margin-top: 16px;
    font-size: 1em;
    font-style: italic;
    font-weight: 600;
  }
  
  .markdown-body dl dd {
    padding: 0 16px;
    margin-bottom: 16px;
  }
  
  .markdown-body table {
    display: block;
    width: 100%;
    overflow: auto;
  }
  
  .markdown-body table th {
    font-weight: 600;
  }
  
  .markdown-body table td,
  .markdown-body table th {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
  }
  
  .markdown-body table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
  }
  
  .markdown-body table tr:nth-child(2n) {
    background-color: #f6f8fa;
  }
  
  .markdown-body img {
    max-width: 100%;
    box-sizing: initial;
    background-color: #fff;
  }
  
  .markdown-body img[align=right] {
    padding-left: 20px;
  }
  
  .markdown-body img[align=left] {
    padding-right: 20px;
  }
  
  .markdown-body code {
    padding: .2em .4em;
    margin: 0;
    font-size: 85%;
    background-color: rgba(27,31,35,.05);
    border-radius: 3px;
  }
  
  .markdown-body pre {
    word-wrap: normal;
  }
  
  .markdown-body pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }
  
  .markdown-body .highlight {
    margin-bottom: 16px;
  }
  
  .markdown-body .highlight pre {
    margin-bottom: 0;
    word-break: normal;
  }
  
  .markdown-body .highlight pre,
  .markdown-body pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 3px;
  }
  
  .markdown-body pre code {
    display: inline;
    max-width: auto;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
  }
  
  .markdown-body .commit-tease-sha {
    display: inline-block;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 90%;
    color: #444d56;
  }
  
  .markdown-body .full-commit .btn-outline:not(:disabled):hover {
    color: #005cc5;
    border-color: #005cc5;
  }
  
  .markdown-body .blob-wrapper {
    overflow-x: auto;
    overflow-y: hidden;
  }
  
  .markdown-body .blob-wrapper-embedded {
    max-height: 240px;
    overflow-y: auto;
  }
  
  .markdown-body .blob-num {
    width: 1%;
    min-width: 50px;
    padding-right: 10px;
    padding-left: 10px;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
    line-height: 20px;
    color: rgba(27,31,35,.3);
    text-align: right;
    white-space: nowrap;
    vertical-align: top;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }
  
  .markdown-body .blob-num:hover {
    color: rgba(27,31,35,.6);
  }
  
  .markdown-body .blob-num:before {
    content: attr(data-line-number);
  }
  
  .markdown-body .blob-code {
    position: relative;
    padding-right: 10px;
    padding-left: 10px;
    line-height: 20px;
    vertical-align: top;
  }
  
  .markdown-body .blob-code-inner {
    overflow: visible;
    font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
    font-size: 12px;
    color: #24292e;
    word-wrap: normal;
    white-space: pre;
  }
  
  .markdown-body .pl-token.active,
  .markdown-body .pl-token:hover {
    cursor: pointer;
    background: #ffea7f;
  }
  
  .markdown-body .tab-size[data-tab-size="1"] {
    -moz-tab-size: 1;
    tab-size: 1;
  }
  
  .markdown-body .tab-size[data-tab-size="2"] {
    -moz-tab-size: 2;
    tab-size: 2;
  }
  
  .markdown-body .tab-size[data-tab-size="3"] {
    -moz-tab-size: 3;
    tab-size: 3;
  }
  
  .markdown-body .tab-size[data-tab-size="4"] {
    -moz-tab-size: 4;
    tab-size: 4;
  }
  
  .markdown-body .tab-size[data-tab-size="5"] {
    -moz-tab-size: 5;
    tab-size: 5;
  }
  
  .markdown-body .tab-size[data-tab-size="6"] {
    -moz-tab-size: 6;
    tab-size: 6;
  }
  
  .markdown-body .tab-size[data-tab-size="7"] {
    -moz-tab-size: 7;
    tab-size: 7;
  }
  
  .markdown-body .tab-size[data-tab-size="8"] {
    -moz-tab-size: 8;
    tab-size: 8;
  }
  
  .markdown-body .tab-size[data-tab-size="9"] {
    -moz-tab-size: 9;
    tab-size: 9;
  }
  
  .markdown-body .tab-size[data-tab-size="10"] {
    -moz-tab-size: 10;
    tab-size: 10;
  }
  
  .markdown-body .tab-size[data-tab-size="11"] {
    -moz-tab-size: 11;
    tab-size: 11;
  }
  
  .markdown-body .tab-size[data-tab-size="12"] {
    -moz-tab-size: 12;
    tab-size: 12;
  }
  
  .markdown-body .task-list-item {
    list-style-type: none;
  }
  
  .markdown-body .task-list-item+.task-list-item {
    margin-top: 3px;
  }
  
  .markdown-body .task-list-item input {
    margin: 0 .2em .25em -1.6em;
    vertical-align: middle;
  }</style>
<style>/* Base16 Atelier Heath Light - Theme */
/* by Bram de Haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/heath) */
/* Original Base16 color scheme by Chris Kempson (https://github.com/chriskempson/base16) */

/* Atelier-Heath Comment */
.hljs-comment,
.hljs-quote {
  color: #776977;
}

/* Atelier-Heath Red */
.hljs-variable,
.hljs-template-variable,
.hljs-attribute,
.hljs-tag,
.hljs-name,
.hljs-regexp,
.hljs-link,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class {
  color: #ca402b;
}

/* Atelier-Heath Orange */
.hljs-number,
.hljs-meta,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params {
  color: #a65926;
}

/* Atelier-Heath Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet {
  color: #918b3b;
}

/* Atelier-Heath Blue */
.hljs-title,
.hljs-section {
  color: #516aec;
}

/* Atelier-Heath Purple */
.hljs-keyword,
.hljs-selector-tag {
  color: #7b59c0;
}

.hljs {
  display: block;
  overflow-x: auto;
  background: #f7f3f7;
  color: #695d69;
  padding: 0.5em;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style>
<nav class="table-of-contents"><ol><li><a href="#%E7%B3%BB%E7%BB%9F%E7%BA%A7%E5%88%AB"> 系统级别</a><ol><li><a href="#%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B"> 进程、线程、协程</a><ol><li><a href="#%E8%BF%9B%E7%A8%8B"> 进程</a></li><li><a href="#%E7%BA%BF%E7%A8%8B"> 线程</a></li><li><a href="#%E5%8D%8F%E7%A8%8B"> 协程</a></li></ol></li><li><a href="#%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C"> 并发和并行</a></li></ol></li><li><a href="#dart%E8%99%9A%E6%8B%9F%E6%9C%BA"> Dart虚拟机</a><ol><li><a href="#flutter%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A7%88%E5%9B%BE"> Flutter系统概览图</a></li><li><a href="#flutter-runner"> Flutter Runner</a><ol><li><a href="#platform-task-runner"> Platform Task Runner</a></li><li><a href="#ui-task-runner"> UI Task Runner</a></li><li><a href="#gpu-task-runner"> GPU Task Runner</a></li><li><a href="#io-task-runner"> IO Task Runner</a></li></ol></li><li><a href="#%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B"> 异步模型</a></li><li><a href="#dart%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"> Dart异步编程</a><ol><li><a href="#isolate"> Isolate</a></li><li><a href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"> 单线程模型</a></li><li><a href="#microtask-queue"> MicroTask Queue</a></li><li><a href="#event-queue"> Event Queue</a></li><li><a href="#%E4%BB%BB%E5%8A%A1%E5%AE%89%E6%8E%92%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"> 任务安排注意事项</a></li></ol></li></ol></li></ol></nav><h1 id="%E7%B3%BB%E7%BB%9F%E7%BA%A7%E5%88%AB"><a class="header-anchor" href="#%E7%B3%BB%E7%BB%9F%E7%BA%A7%E5%88%AB">§</a> 系统级别</h1>
<h2 id="%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B"><a class="header-anchor" href="#%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B">§</a> 进程、线程、协程</h2>
<h3 id="%E8%BF%9B%E7%A8%8B"><a class="header-anchor" href="#%E8%BF%9B%E7%A8%8B">§</a> 进程</h3>
<p>进程是系统进行资源分配和调度的一个独立单元，有独立的内存空间。</p>
<h3 id="%E7%BA%BF%E7%A8%8B"><a class="header-anchor" href="#%E7%BA%BF%E7%A8%8B">§</a> 线程</h3>
<p>CPU、操作系统、编程语言的线程的的概念很容易混淆。</p>
<p>对于CPU来说，超线程就是物理线程，一个4核8线程的CPU，他代表的是可以有8个并行内核线程数同时运行。</p>
<p>而对于操作系统抽象出来的线程就是内核线程，内核线程由进程创建，有操作系统统一调度，丢给8个CPU物理线程去执行。</p>
<p>而对于编程语言来说分三种情况：</p>
<ol>
<li>如Java直接包装一下系统线程，那么Java中的线程就等于是系统中的线程。</li>
<li>完全在用户空间实现的线程，也就是编程语言自己封装的一套调度。这样的话操作系统对这些线程是不知道的，很早的一些语言会这样做，有操作系统不支持线程的情况。</li>
<li>如Dart有自己的一套封装，同时也利用了系统多线程优势。</li>
</ol>
<h3 id="%E5%8D%8F%E7%A8%8B"><a class="header-anchor" href="#%E5%8D%8F%E7%A8%8B">§</a> 协程</h3>
<p>协程叫做<code>coroutine</code>，是一种比线程更小的单元。可以理解为进程&gt;线程&gt;协程。</p>
<p>但是线程和协程执行方式完全不同。</p>
<p>线程中执行子程序(函数)的调用顺序是明确的，一层一层，一个接一个的调用。</p>
<p>但是在协程中在子程序内可以中断，然后转而执行别的子程序，之后再返回来执行，跟CPU的中断十分相似。</p>
<p>Dart中async和await的实现。</p>
<p>协程分为<code>无线协程</code>和<code>有线协程</code>，无线协程在离开当前调用位置时，会将当前变量放在堆区，当再次回到当前位置时，还会继续从堆区中获取到变量。所以，一般在执行当前函数时就会将变量直接分配到堆区，而<code>async</code>、<code>await</code>就属于无线协程的一种。有线协程则会将变量继续保存在栈区，在回到指针指向的离开位置时，会继续从栈中取出调用。</p>
<h2 id="%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C"><a class="header-anchor" href="#%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C">§</a> <a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/">并发和并行</a></h2>
<blockquote>
<p>“并发”指的是程序的结构，“并行”指的是程序运行时的状态</p>
</blockquote>
<p>并行(parallelism)就是像CPU多个线程同时执行任务。</p>
<p>并发(concurrency)就如协程，使多个操作可以在重叠的时间段内进行，可以当做成一个设计标准。</p>
<blockquote>
<p>任何属于冯诺依曼结构的计算机，其中的CPU（或者说核）必然是串行执行指令的。所以在任何单CPU机器上，是不存在严格意义上，或者说狭义上的并行的－－在指令级别的严格意义上的并行，是指在一个足够小的时刻，可以允许大于一条的指令在执行。</p>
</blockquote>
<h1 id="dart%E8%99%9A%E6%8B%9F%E6%9C%BA"><a class="header-anchor" href="#dart%E8%99%9A%E6%8B%9F%E6%9C%BA">§</a> Dart虚拟机</h1>
<p>思考问题：</p>
<ol>
<li>dart vm是怎样执行同步代码和异步代码的？</li>
<li>Isolate和系统线程是什么关系？</li>
<li>如果执行dart代码的时候只启动了一个root Isolate，那么是怎么保证同步和异步代码执行顺序？</li>
<li>Flutter Runner和isolate之间的关系</li>
</ol>
<h2 id="flutter%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A7%88%E5%9B%BE"><a class="header-anchor" href="#flutter%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%A7%88%E5%9B%BE">§</a> Flutter系统概览图</h2>
<p><img src="https://zzaning-assets.oss-cn-hangzhou.aliyuncs.com/2020/05/screenshot20200418at95401am.png" alt="Screen_Shot_2020-04-18_at_9.54.01_A"></p>
<ol>
<li><code>Framework(dart)</code>:可以理解为UI框架</li>
<li><code>Engine(C/C++)</code>:引擎层，可以理解为用于驱动<code>Framework</code>例如:<code>Skia</code>、<code>DartVM</code>、<code>Shell</code></li>
<li><code>Embedder(Platform Specific)</code>:嵌入层， 为<code>Engine</code>提供四个<code>Task Runner</code>，渲染设置、原生插件、打包、线程管理，事件循环交互操作为</li>
</ol>
<p>Flutter Runner存在于Embedder层，而Root Isolate存在Engine的Dart VM。
Runner和Isolate是相互独立的，但是在Flutter里面Isolate要依赖于Runner，因为Isolate里面的任务是要丢给系统线程执行的，而系统线程的提供就交给Embedder层了。
不同平台Framework和Engine是一样的，区别在于Embedder。</p>
<h2 id="flutter-runner"><a class="header-anchor" href="#flutter-runner">§</a> Flutter Runner</h2>
<p>Runner的创建策略：</p>
<p>iOS、Android平台每启动一个<code>Flutter Engine</code>时为UI，GPU，IO Runner各自创建一个线程，但是共享Platform Runner线程(每启动一个<code>FlutterViewController</code>就会创建一个<code>Engine</code>)。</p>
<p>Fushia每启动一个<code>Engine</code>为UI，GPU，IO，Platform各自创建一个线程。</p>
<h3 id="platform-task-runner"><a class="header-anchor" href="#platform-task-runner">§</a> Platform Task Runner</h3>
<p>是Android和iOS平台应用的主线程</p>
<p>负责 <code>Flutter Embedder</code>和 iOS、Android 进程之间的通信。App 进程所有的消息都是通过 <code>Platform Task Runner</code> 来接受处理，根据职责单一设计模式，很自然的 <code>Platform Task Runner</code> 就拥有调度整个 Flutter 执行流程的责任。所有与 iOS、Android 平台之间的交互都需要在该 <code>Task</code> 中进行。</p>
<p>阻塞Platform Thread不会直接导致Flutter应用的卡顿（跟iOS android主线程不同，因为Dart是自己的渲染引擎，自己生成GPU渲染资源，并不在iOS主线程中进行这些操作）。尽管如此，长时间卡住Platform Thread应用有可能会被系统Watchdog强杀。</p>
<h3 id="ui-task-runner"><a class="header-anchor" href="#ui-task-runner">§</a> UI Task Runner</h3>
<p>是Android和iOS平台应用的子线程</p>
<p>用于执行<code>Dart Root Isolate</code>代码。负责渲染相关的操作，负责Timer，Microtask，异步IO等操作。</p>
<p>Flutter中渲染机制：</p>
<ol>
<li>Root Isolate 通知 Flutter Engine 有帧需要渲染，Flutter Engine 通过 Platform Runner 通知 iOS、Android 平台需要在下一个 vsync 的时候得到通知。</li>
<li>iOS、Android 平台等待下一个 vsync 信号。</li>
<li>当 vsync 信号发送过来时，UI Task 把 Widgets Tree 进行 Layout 计算并生成一个 Layer Tree，把这个 Layer Tree 提交给 GPU Task。这个阶段没有进行任何光栅化，仅是生成了对需要绘制内容的描述，Layer Tree 包含了用于屏幕上显示 Widgets 的各种信息，用于配置和渲染。</li>
<li>GPU Task 渲染完成后通过 Platform Task 通知 iOS、Android 平台进行后续渲染操作，完成后会刷新数据到硬件显存中去，然后在下一个 vsync 信号发出后，硬件会从显存中读取上一帧的计算结果然后同步到显示器上。</li>
</ol>
<p>这个线程的过载会直接导致卡顿掉帧。</p>
<h3 id="gpu-task-runner"><a class="header-anchor" href="#gpu-task-runner">§</a> GPU Task Runner</h3>
<p>是Android和iOS平台应用的子线程</p>
<p>用于执行<code>GPU</code>指令，UI Task Runner创建的Layer Tree是跨平台的，它不关心到底由谁来完成绘制。<code>GPU Task</code>负责将Layer Tree提供的信息转换为平台可执行的<code>GPU</code>指令，负责绘制<code>GPU</code>资源的管理，包括<code>Framebuffer</code>，<code>Surface</code>、<code>Texture</code>、<code>Buffers</code></p>
<p><code>GPU Runner</code> 会根据目前帧执行的进度去向 <code>UI Runner</code> 要求下一帧的数据，在任务繁重的时候可能会告诉<code>UI Runner</code> 延迟任务，这种调度机制确保 <code>GPU Runner</code> 不至于过载，同时也避免了 <code>UI Runner</code> 不必要的消耗</p>
<p>这个线程的过载会直接导致卡顿掉帧。</p>
<h3 id="io-task-runner"><a class="header-anchor" href="#io-task-runner">§</a> IO Task Runner</h3>
<p>是Android和iOS平台应用的子线程</p>
<p>处理图片数据，为<code>GPU</code>渲染做准备，比如读取磁盘压缩图片的格式，将解压成<code>GPU</code>能处理的格式，并传给<code>GPU</code>，因其比较消耗性能所以单独开一个线程。</p>
<p><img src="https://zzaning-assets.oss-cn-hangzhou.aliyuncs.com/2020/05/v28d696d1bd6d45dbac91e7a47d35216f4720w.jpg" alt="v2-8d696d1bd6d45dbac91e7a47d35216f4_720"></p>
<h2 id="%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B"><a class="header-anchor" href="#%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8B">§</a> 异步模型</h2>
<p><img src="https://zzaning-assets.oss-cn-hangzhou.aliyuncs.com/2020/05/screen-shot-20200526-at-92135-pm.png" alt="Screen Shot 2020-05-26 at 9.21.35 P"></p>
<p>多线程虽然好用，但是在大量并发时，仍然存在两个较大的缺陷，一个是开辟线程比较耗费资源，线程开多了机器吃不消，另一个则是线程的锁问题，多个线程操作共享内存时需要加锁，复杂情况下的锁竞争不仅会<strong>降低性能</strong>，还可能<strong>造成死锁</strong>。</p>
<p>因此又出现了基于事件的异步模型。简单说就是在某个单线程中存在一个事件循环和一个事件队列，事件循环不断的从事件队列中取出事件来执行，这里的事件就好比是一段代码，每当遇到耗时的事件时，事件循环不会停下来等待结果，它会跳过耗时事件，继续执行其后的事件。当不耗时的事件都完成了，再来查看耗时事件的结果。因此，耗时事件不会阻塞整个事件循环，这让它后面的事件也会有机会得到执行。</p>
<p>这种基于事件的异步模型，只适合I/O密集型的耗时操作，因为I/O耗时操作，往往是把时间浪费在等待对方传送数据或者返回结果，因此这种异步模型往往用于网络服务器并发。如果是计算密集型的操作，则应当尽可能利用处理器的多核，实现并行计算。</p>
<p>关于在采用基于时间的异步模型中，如dart。
延时任务并不是准确的就能理解了，因为万一前面有很耗时的任务，那么你的延迟任务不一定能准时运行。</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span>  <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">import</span>  <span class="hljs-string">'dart:io'</span>;

<span class="hljs-keyword">void</span>  main() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"main start"</span>);

    <span class="hljs-keyword">new</span> Future.delayed(<span class="hljs-keyword">new</span>  <span class="hljs-built_in">Duration</span>(seconds:<span class="hljs-number">1</span>),(){
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'task delayed'</span>);
    });

    <span class="hljs-keyword">new</span> Future((){
        <span class="hljs-comment">// 模拟耗时5秒</span>
        sleep(<span class="hljs-built_in">Duration</span>(seconds:<span class="hljs-number">5</span>));
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"5s task"</span>);
    });

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"main stop"</span>);
}

<span class="hljs-comment">// 运行结果</span>
main start
main stop
<span class="hljs-number">5</span>s task
task delayed
</code></pre>
<h2 id="dart%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><a class="header-anchor" href="#dart%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B">§</a> Dart异步编程</h2>
<h3 id="isolate"><a class="header-anchor" href="#isolate">§</a> Isolate</h3>
<p><code>isolate</code>是<code>Dart</code>平台对线程的实现方案，但和普通<code>Thread</code>不同的是，<code>isolate</code>拥有独立的内存，<code>isolate</code>由线程和独立内存构成。正是由于<code>isolate</code>线程之间的内存不共享，所以<code>isolate</code>线程之间并不存在资源抢夺的问题，所以也不需要锁。</p>
<p>这意味着你不能访问主线程中的变量，或者使用 <code>setState()</code> 来更新 UI。</p>
<p>通过<code>isolate</code>可以很好的利用多核CPU，来进行大量耗时任务的处理。<code>isolate</code>线程之间的通信主要通过<code>port</code>来进行，这个<code>port</code>消息传递的过程是异步的。通过<code>Dart</code>源码也可以看出，实例化一个<code>isolate</code>的过程包括，实例化<code>isolate</code>结构体、在堆中分配线程内存、配置<code>port</code>等过程。</p>
<p><code>isolate</code>的整体模型其实更像进程，而<code>async</code>、<code>await</code>更像是线程。</p>
<pre class="hljs"><code><span class="hljs-comment">/// <span class="markdown">使用</span></span>
Isolate isolate;

<span class="hljs-comment">// 启动新的Isolate，并监听消息</span>
start() <span class="hljs-keyword">async</span> {
  ReceivePort receivePort = ReceivePort();
  isolate = <span class="hljs-keyword">await</span> Isolate.spawn(entryPoint, receivePort.sendPort, debugName: <span class="hljs-string">'newIsolate'</span>);

  receivePort.listen((message) {
    debugPrint(<span class="hljs-string">'<span class="hljs-subst">${Isolate.current.debugName}</span>: receive msg <span class="hljs-subst">$message</span>'</span>);
  });
  debugPrint(<span class="hljs-string">'<span class="hljs-subst">${Isolate.current.debugName}</span>: spawn'</span>);
}

<span class="hljs-comment">// 新Isolate入口函数</span>
entryPoint(SendPort sendPort) {
  <span class="hljs-built_in">int</span> counter = <span class="hljs-number">0</span>;
  Timer.periodic(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span>), (Timer t) {
    debugPrint(<span class="hljs-string">'<span class="hljs-subst">${Isolate.current.debugName}</span>: send msg <span class="hljs-subst">${counter++}</span>'</span>);
    sendPort.send(<span class="hljs-built_in">DateTime</span>.now());
  });
}

<span class="hljs-comment">// 结束Isolate</span>
<span class="hljs-keyword">void</span> stop() {
  <span class="hljs-keyword">if</span> (isolate != <span class="hljs-keyword">null</span>) {
    isolate.kill(priority: Isolate.immediate);
    isolate = <span class="hljs-keyword">null</span>;
    debugPrint(<span class="hljs-string">'<span class="hljs-subst">${Isolate.current.debugName}</span>: killed isolate'</span>);
  }
}

<span class="hljs-comment">///<span class="markdown">在Flutter中，Framework为我们封装了一套API来简化Isolate的使用。</span></span>
Future&lt;<span class="hljs-built_in">List</span>&lt;Photo&gt;&gt; fetchPhotos(http.Client client) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> response =
      <span class="hljs-keyword">await</span> client.<span class="hljs-keyword">get</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/photos'</span>);
  <span class="hljs-keyword">return</span> compute(parsePhotos, response.body);
}

<span class="hljs-built_in">List</span>&lt;Photo&gt; parsePhotos(<span class="hljs-built_in">String</span> responseBody) {
  <span class="hljs-keyword">final</span> parsed = json.decode(responseBody);
  <span class="hljs-keyword">return</span> parsed.map&lt;Photo&gt;((json) =&gt; Photo.fromJson(json)).toList();
}
</code></pre>
<h3 id="%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"><a class="header-anchor" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B">§</a> 单线程模型</h3>
<p>说Dart是单线程，是因为Dart程序运行是会创建一个主<code>Isolate</code>，除非你再创建一个另外<code>Isolate</code>，否则你的代码将会永远运行在主UI线程上。</p>
<p><code>**Isolate</code>中有两个队列：**</p>
<p><img src="https://zzaning-assets.oss-cn-hangzhou.aliyuncs.com/2020/05/46.png" alt="46"></p>
<h3 id="microtask-queue"><a class="header-anchor" href="#microtask-queue">§</a> MicroTask Queue</h3>
<p>这是一个高权限消息队列，主要处理来自 Dart 的事件。</p>
<pre class="hljs"><code><span class="hljs-comment">// 通过这两种方式添加任务</span>
Future.microtask(computation);

<span class="hljs-keyword">import</span> <span class="hljs-string">'dart:async'</span>;
<span class="hljs-keyword">async</span>.scheduleMicrotask(() {
  <span class="hljs-comment">// ...code goes here...</span>
});
</code></pre>
<h3 id="event-queue"><a class="header-anchor" href="#event-queue">§</a> Event Queue</h3>
<p>这是一个标准消息队列，处理包含所有的外部事件，I/O、用户交互事件、绘制事件、timers、两个isolates之间的消息等等。</p>
<p>异步任务，丢到Event Queue后也只是顺序执行的。</p>
<p>使用<code>Future</code>类，可以将任务加入到Event Queue的队尾。</p>
<p>异步任务通过<code>await</code>和<code>async</code>关键字，借助于Event Loop实现非租塞同步等。</p>
<h3 id="%E4%BB%BB%E5%8A%A1%E5%AE%89%E6%8E%92%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><a class="header-anchor" href="#%E4%BB%BB%E5%8A%A1%E5%AE%89%E6%8E%92%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">§</a> 任务安排注意事项</h3>
<ul>
<li>尽可能的使用 event queue（即，使用 <code>Future</code> 和 <code>Future.delayed()</code>）。</li>
<li>使用 Future 的 then() 和 whenComplete() 来处理任务顺序。</li>
<li>为了避免 event loop 阻塞，尽量避免使用 microtask queue。</li>
<li>为了使得 app 尽可能快的响应，应该在另外的 isolate 或者 worker 中运行计算密集型任务，避免在 queue 中运行计算密集型任务。</li>
</ul>
